
<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Market Insights – CrewAI</title>
  <style>
    body { font-family: Segoe UI, sans-serif; margin: 2rem; }
    textarea { width: 100%; height: 300px; }
  </style>
</head>
<body>
  <h1>Market Insights – Multi-Agent Crew</h1>
  <p>Skriv inn et tema og start analysen.</p>

  <input id="topic" size="80"
    value="AI i finans – regulatoriske trender 2026">
  <button onclick="run()">Start analyse</button>

  <h3>Status</h3>
  <p>Job ID: <span id="jid"></span></p>
  <p>Status: <span id="status"></span></p>

  <h3>Resultat</h3>
  <textarea id="output"></textarea>

<script>
async function run() {
  const topic = document.getElementById('topic').value;
  const resp = await fetch('/api/run', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({topic})
  });
  const data = await resp.json();
  document.getElementById('jid').textContent = data.job_id;
  poll(data.job_id);
}

async function poll(jobId) {
  const interval = setInterval(async () => {
    const resp = await fetch('/api/status/' + jobId);
    const data = await resp.json();
    document.getElementById('status').textContent = data.status;

    if (data.status === 'completed') {
      clearInterval(interval);
      document.getElementById('output').value =
        typeof data.result === "string" ?
          data.result : JSON.stringify(data.result, null, 2);
    }

    if (data.status === 'failed') {
      clearInterval(interval);
      document.getElementById('output').value = "Error: " + data.error;
    }
  }, 2000);
}
</script>
</body>
</html>
